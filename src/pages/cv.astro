---
import Layout from '@/layouts/Layout.astro'
import { experiences, education, skills, publications } from '../data/cv'
import { highlightAuthor } from '@/lib/utils'
import { template } from '../settings'

import type { Experience, Education, Publication } from '../types/cv'

let orderdExperiences: Experience[] = []
let orderdEducations: Education[] = []
let orderedPublications: Publication[] = []

const orderElement = <T extends { time: string }>(a: T, b: T) => {
  const presentValues = ['present', 'now', 'current', 'today']
  if (
			presentValues.includes(
				(a['time'] as string)?.split(' - ')[1]?.toLowerCase()
			)
		) {
			// If the date is 'present', it should be the first element
			return -1
		}
		const dateA = new Date((a['time'] as string)?.split(' - ')[1])
		const dateB = new Date((b['time'] as string)?.split(' - ')[1])
		return dateB.getTime() - dateA.getTime()
}

if (experiences.length > 0) {
	orderdExperiences = experiences.sort((a, b) => {
		return orderElement(a, b)
	})
}

if (education.length > 0) {
	orderdEducations = education.sort((a, b) => {
		return orderElement(a, b)
	})
}

if (publications.length > 0) {
	orderedPublications = publications.sort((a, b) => {
		return orderElement(a, b)
	})
}
---

<Layout title="CV | Harutyun Harry Ilanyan">
	<div class="max-w-5xl mx-auto bg-white dark:bg-base-100 p-8 shadow-lg rounded-lg">
		<!-- Small, clean download button in top-right -->
		<div class="flex justify-end mb-6">
			<a 
				href={`${template.base}/Resume_HarryIlanyan_2.html`}
				download="HarryIlanyan_Resume.html"
				class="btn btn-sm btn-ghost gap-2 text-base-content/70 hover:text-base-content"
			>
				<svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
					<path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" />
				</svg>
				Download Resume
			</a>
		</div>

		<!-- Resume Content via iframe -->
		<div class="resume-container">
			<iframe 
				src={`${template.base}/Resume_HarryIlanyan_2.html`}
				class="w-full border-0 rounded-lg"
				style="min-height: 1200px; height: auto;"
				title="Harry Ilanyan Resume"
				onload="this.style.height = this.contentWindow.document.body.scrollHeight + 'px';"
			></iframe>
		</div>
	</div>
</Layout>

<style>
	@media print {
		.btn {
			display: none !important;
		}
		
		body {
			background: white !important;
		}
		
		.shadow-lg {
			box-shadow: none !important;
		}
	}

	.resume-container {
		width: 100%;
		overflow: hidden;
	}

	iframe {
		width: 100%;
		border: none;
		overflow: hidden;
	}
</style>
